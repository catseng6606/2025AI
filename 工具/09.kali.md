# Kali Linux Environment Setup

## 1. SSH Server

安裝並啟用 SSH 服務，以便遠端連線。

```bash
sudo apt update
sudo apt install -y openssh-server
sudo systemctl enable ssh --now
# 檢查狀態
sudo systemctl status ssh
ifconfig | grep 192.168
```

## 2. Docker

安裝 Docker 容器引擎。

```bash
# 更新套件庫
sudo apt update

# 安裝 Docker
sudo apt install -y docker.io

# 啟動並設定開機自動啟動
sudo systemctl enable docker --now

# 將當前使用者加入 docker 群組 (避免每次都要 sudo)
sudo usermod -aG docker $USER

# 重新登入群組以生效
newgrp docker
```

## 3. Docker Compose

安裝 Docker Compose。

```bash
# 1. 刪除舊的錯誤設定檔
sudo rm -f /etc/apt/sources.list.d/docker.list

# 2. 更新系統索引並安裝基礎工具
sudo apt update
sudo apt install -y ca-certificates curl gnupg lsb-release

# 3. 建立金鑰存放目錄
sudo install -m 0755 -d /etc/apt/keyrings

# 4. 下載 Debian 的 GPG 金鑰
curl -fsSL https://download.docker.com/linux/debian/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg
sudo chmod a+r /etc/apt/keyrings/docker.gpg

# 5. 寫入 Debian 'bookworm' 軟體源 (Kali 最相容的版本)
echo \
  "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/debian \
  bookworm stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null

# 6. 更新系統索引並安裝 Docker
sudo apt update
sudo apt install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin

# 7. 檢查 Docker 版本
docker --version
docker compose version
```

## 4. Docker PHP + MySQL + phpMyAdmin

快速建立 LAMP 開發環境。
建立環境變數文件 `env.example`:

```bash
MYSQL_ROOT_PASSWORD=root_password
MYSQL_DATABASE=my_database
MYSQL_USER=user
MYSQL_PASSWORD=user_password
PMA_HOST=mysql
```

建立 `docker-compose.yml`:

```yaml
services:
  php:
    build: .
    ports:
      - "8080:80"
    volumes:
      - ./www:/var/www/html
    environment:
      - MYSQL_HOST=mysql
      - MYSQL_USER=${MYSQL_USER}
      - MYSQL_PASSWORD=${MYSQL_PASSWORD}
      - MYSQL_DATABASE=${MYSQL_DATABASE}
    depends_on:
      - mysql

  mysql:
    image: mysql:8.0
    environment:
      MYSQL_ROOT_PASSWORD: ${MYSQL_ROOT_PASSWORD}
      MYSQL_DATABASE: ${MYSQL_DATABASE}
      MYSQL_USER: ${MYSQL_USER}
      MYSQL_PASSWORD: ${MYSQL_PASSWORD}
    volumes:
      - db_data:/var/lib/mysql

  phpmyadmin:
    image: phpmyadmin/phpmyadmin
    ports:
      - "8081:80"
    environment:
      PMA_HOST: ${PMA_HOST}
    depends_on:
      - mysql

volumes:
  db_data:
```

啟動服務:

```bash
docker compose up -d
```
